<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <title>ขนาดร่างกาย</title>

    <style>
        body {
            background-color: #F8D568;
        }
    </style>
</head>

<body>
    <!-- Navber -->
    <nav class="navbar bg-light fixed-top">
        <div class="container-fluid">
            <div class="col">
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="navbar-brand" href="home.html">Assump Chana</a>
            </div>
            <!-- LOGIN BUTTON-->
            <a>
                <button class="btn btn-outline-success" type="submit" id="btnauth">เข้าสู่ระบบ</button>
            </a>

            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
                aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Assump Chana</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                        <li class="nav-item">
                            <a class="nav-link" aria-current="page" href="#">ห้องความรู้</a>
                        </li>
                        <li>
                            <a class="nav-link" href="timemedicine.html">ตารางกินยา</a>
                        </li>
                        <li>
                            <a class="nav-link" href="reminder.html">เตือนกินยา</a>
                        </li>
                        <li>
                            <a class="nav-link" href="hospital.html">ติดต่อโรงพยาบาล</a>
                        </li>
                        <li>
                            <a class="nav-link" href="pharmacy.html">ร้านขายยาใกล้ฉัน</a>
                        </li>
                        <li>
                            <a class="nav-link" href="personalinfo.html">ข้อมูลส่วนตัว</a>
                        </li>
                        <li>
                            <a class="nav-link" href="bodyinfo.html">ขนาดร่างกาย</a>
                        </li>
                        <li>
                            <a class="nav-link" href="bedtime.html">การนอน</a>
                        </li>
                        <li>
                            <a class="nav-link" href="game.html">เกมส์</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                                aria-expanded="false">
                                เกี่ยวกับเรา
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="whatis.html">What is Assump Chana</a></li>
                                <li><a class="dropdown-item" href="contractus.html">ติดต่อเรา</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- content -->
    <!-- คำนวน -->
    <div class="row justify-content-center text-center" style="margin-top: 5%;">
        <div class="card border-warning mb-3" style="max-width: 50rem; max-height: 50rem;">
            <div class="card-header text-center">คำนวณร่างกาย</div>
            <div class="card-body">
                <div class="input-group input-group-lg" style="margin-bottom: 3%;">
                    <span class="input-group-text" id="inputGroup-sizing-lg"
                        style="width: 190px;">น้ำหนัก(กิโลกรัม)</span>
                    <input id="weight" type="number" class="form-control" aria-label="Sizing example input"
                        aria-describedby="inputGroup-sizing-lg" required>
                </div>
                <div class="input-group input-group-lg" style="margin-bottom: 3%;">
                    <span class="input-group-text" id="inputGroup-sizing-lg "
                        style="width: 190px;">ส่วนสูง(เซนติเมตร)</span>
                    <input id="height" type="number" class="form-control" aria-label="Sizing example input"
                        aria-describedby="inputGroup-sizing-lg" required>
                </div>
                <div class="text-left col-12">
                    <div class="row">
                        <div class="col-2">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="exampleRadios" id="male" value="male"
                                    checked required>
                                <label class="form-check-label" for="male">
                                    ชาย
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="exampleRadios" id="female"
                                    value="female" required>
                                <label class="form-check-label" for="female">
                                    หญิง
                                </label>
                            </div>
                        </div>
                        <div class="col-10">
                            <div class="input-group input-group-lg" style="margin-bottom: 3%;">
                                <span class="input-group-text" id="inputGroup-sizing-lg ">อายุ</span>
                                <input id="age" type="number" class="form-control" aria-label="Sizing example input"
                                    aria-describedby="inputGroup-sizing-lg" required>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ปุ่มกด -->
                <div>
                    <button class="btn" style="background-color: #F8D568; height: 60px; width: 650px"
                        id="cal">คำนวน</button>
                </div>
                <div style="margin-top: 1%;">
                    <button class="btn" style="background-color: #037425; height: 60px; width: 650px"
                        id="save">บันทึก</button>
                </div>
                <!-- แสดงผล -->
                <div class="col-12">
                    <div class="row justify-content-center" style="margin-top: 3%;">
                        <!-- BMI -->
                        <div class="card border-success mb-3 justify-content-center"
                            style="width: 13rem;height: 3rem; margin-right:1%;">
                            <div class="card-body text-success">
                                <h5 class="card-title" id="bmi">ค่า BMI</h5>
                            </div>
                        </div>
                        <!-- Water -->
                        <div class="card border-success mb-3 justify-content-center"
                            style="width: 13rem;height: 3rem; margin-right:1%;">
                            <div class="card-body text-success">
                                <h5 class="card-title" id="water">ปริมาณน้ำ/วัน</h5>
                            </div>
                        </div>
                        <!-- Calories -->
                        <div class="card border-success mb-3 justify-content-center"
                            style="width: 13rem; height: 3rem;">
                            <div class="card-body text-success">
                                <h5 class="card-title" id="bmr">แคลอรี่/วัน</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card" style="width: 50rem;">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">BMI kg/m^2</th>
                        <th scope="col">อยู่ในเกณท์</th>
                        <th scope="col">ภาวะเสี่ยงต่อโรค</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="" id="t1">
                        <td>น้อยกว่า 18.50</td>
                        <td>น้ำหนักน้อย / ผอม</td>
                        <td>มากกว่าคนปกติ</td>
                    </tr>
                    <tr class="" id="t2">
                        <td>ระหว่าง 18.50 - 22.90</td>
                        <td>ปกติ (สุขภาพดี)</td>
                        <td>เท่าคนปกติ</td>
                    </tr>
                    <tr class="" id="t3">
                        <td>ระหว่าง 23 - 24.90</td>
                        <td>ท้วม / โรคอ้วนระดับ 1</td>
                        <td>อันตรายระดับ 1</td>
                    </tr>
                    <tr class="" id="t4">
                        <td>ระหว่าง 25 - 29.90</td>
                        <td>อ้วน / โรคอ้วนระดับ 2</td>
                        <td>อันตรายระดับ 2</td>
                    </tr>
                    <tr class="" id="t5">
                        <td>มากกว่า 30</td>
                        <td>อ้วนมาก / โรคอ้วนระดับ 3</td>
                        <td>อันตรายระดับ 3</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- กราฟ -->
    <div class="container justify-content-center text-center">
        <div class="row my-3">
            <div class="col text-center">
                <h2>กราฟ</h2>
            </div>
        </div>
        <div class="row my-2">
            <div class="col-md-12 py-1">
                <div class="card">
                    <div class="card-body">
                        <canvas id="chLine"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>

<script></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://cdnjs.cloudflare.com/ajax/libs/firebase/9.15.0/firebase-auth.min.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics.js";
    import { getFirestore, doc, setDoc, addDoc, collection, getDocs } from "https://cdnjs.cloudflare.com/ajax/libs/firebase/9.15.0/firebase-firestore.js";
    //firebase/firestore
    const firebaseConfig = {
        apiKey: "AIzaSyBizgZbCCAYS7qzFkDwX6qrbgj3yFkGQHY",
        authDomain: "assump-chana.firebaseapp.com",
        projectId: "assump-chana",
        storageBucket: "assump-chana.appspot.com",
        messagingSenderId: "593385574351",
        appId: "1:593385574351:web:454331c8d1ca255912ccba",
        measurementId: "G-GN25FCXHZ7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const user = auth.currentUser;

    (function () {
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, see docs for a list of available properties
                // https://firebase.google.com/docs/reference/js/firebase.User
                const uid = user.uid;
                document.getElementById("btnauth").innerHTML = 'ออกจากระบบ'
                document.getElementById("btnauth").className = 'btn btn-warning'
                console.log('login')

            } else {
                // User is signed out
                console.log('ไม่มีการเข้าสู่ระบบ')
                // ...
            }
            try {
                const colRef = collection(db, user.uid);
                const docsSnap = getDocs(colRef)
                    .then((snapshot) => {
                        snapshot.forEach((doc) => {
                            chartData.datasets[0].data.push(doc.data().weight)
                            chartData.datasets[1].data.push(doc.data().height)
                            chart.update()
                        });
                    })
            } catch (error) {
                console.log(error);
            }
        })
    })()

    function calculate() {
        let weight = document.getElementById('weight').value;
        let height = document.getElementById('height').value;
        let age = document.getElementById('age').value
        let height1 = height / 100;
        // BMI
        let bmi = weight / (height1) ** 2;
        bmi = bmi.toFixed(2);
        // Water
        let water = weight * 2.2 * 30 / 2;
        water = water.toFixed(0)
        document.getElementById('water').innerHTML = water + ' มล.'
        //Cal
        let bmr
        if (document.getElementById('male').checked == true) {
            bmr = 66 + (13.7 * weight) + (5 * height) - (6.8 * age)
        } else if (document.getElementById('female').checked == true) {
            bmr = 665 + (9.6 * weight) + (1.8 * height) - (4.7 * age)
        }
        bmr = bmr.toFixed(2)
        document.getElementById('bmr').innerHTML = bmr + ' Kcal'


        document.getElementById("t1").classList.remove('table-success');
        document.getElementById("t2").classList.remove('table-success');
        document.getElementById("t3").classList.remove('table-success');
        document.getElementById("t4").classList.remove('table-success');
        document.getElementById("t5").classList.remove('table-success');
        if (bmi < 18.50) {
            document.getElementById("bmi").innerHTML = bmi
            document.getElementById("t1").className = 'table-success'
        } else if (bmi >= 18.50 && bmi <= 22.90) {
            document.getElementById("bmi").innerHTML = bmi
            document.getElementById("t2").className = 'table-success'
        }
        else if (bmi >= 23 && bmi <= 24.90) {
            document.getElementById("bmi").innerHTML = bmi
            document.getElementById("t3").className = 'table-success'
        }
        else if (bmi >= 25 && bmi <= 29.90) {
            document.getElementById("bmi").innerHTML = bmi
            document.getElementById("t4").className = 'table-success'
        }
        else if (bmi > 30) {
            document.getElementById("bmi").innerHTML = bmi
            document.getElementById("t5").className = 'table-success'
        }
    }

    document.getElementById('cal').addEventListener("click", calculate)


    document.getElementById('btnauth').addEventListener('click', function () {
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'login.html'
                console.log(user.email)
            } else if (user) {
                signOut(auth).then(() => {
                    // Sign-out successful.
                    alert("Sign-out successful");
                    window.location.href = 'login.html'
                }).catch((error) => {
                    // An error happened.
                    alert(error);
                });
            }
        })
    })


    document.getElementById('save').addEventListener('click', function () {
        let weight = document.getElementById('weight').value;
        let height = document.getElementById('height').value;
        var date = new Date()
        onAuthStateChanged(auth, (user) => {
            addDoc(collection(db, user.uid), {
                weight: weight,
                height: height,
                date: date,
            });
            alert('บันทึกสำเร็จ')
            setTimeout(function () {
                window.location.href = 'bodyinfo.html'
            }, 1000)
            
        })
    })

    /* Chart */

    // chart colors
    var colors = ['#007bff', '#28a745', '#333333', '#c3e6cb', '#dc3545', '#6c757d'];

    /* large line chart */
    var chLine = document.getElementById("chLine");
    var chartData = {
        labels: ["มค", "กพ", "มีค", "เมย", "พค", "มิย", "กค", "สค", "กย", "ตค", "พย", "ธค"],
        datasets: [
            {
                data: [],
                label: 'น้ำหนัก',
                backgroundColor: colors[0],
                borderColor: colors[0],
                borderWidth: 4,
                pointBackgroundColor: colors[2]
            },

            {
                data: [],
                label: 'ส่วนสูง',
                backgroundColor: colors[3],
                borderColor: colors[1],
                borderWidth: 4,
                pointBackgroundColor: colors[3]
            }
        ]
    };

    var chart = new Chart(chLine, {
        type: 'line',
        data: chartData,
        options: {
            legend: {
                display: true
            },
            responsive: true
        }
    });

    //var chLine1 = document.getElementById("chLine1");
    //if (chLine1) {
    //    new Chart(chLine1, {
    //        type: 'line',
    //        data: {
    //            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
    //            datasets: [
    //                {
    //                    backgroundColor: '#ffffff',
    //                    borderColor: '#ffffff',
    //                    data: [10, 11, 4, 11, 4],
    //                    fill: false
    //                }
    //            ]
    //        },
    //        options: lineOptions
    //    });
    //}
</script>

</html>